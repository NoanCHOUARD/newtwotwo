<html>
  <head>
    <title>Setup</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>

  </head>
  <body>
    <!-- exo 1 <a-scene>
      <a-box position="0 0.5 -5" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="0 1.5 -5" radius="0.5" color="#EF2D5E"></a-sphere>
      <a-cylinder position="0 2.5 -5" radius="0.5" rotation="90 0 -30" height="1.5" color="#FFC65D"></a-cylinder>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
      <a-camera position="0 1.5 5"></a-camera>
    </a-scene> -->

    <!-- exo 2 -->

    <!-- <a-scene>
        <a-asset>
            <img id="groundTexture" src="/assets/Moon_texture.jpg" alt="">
            <img id="normal" src="/assets/normal.jpg" alt="">
            <img id="sky" src="assets/sky.jpg" alt="">
        </a-asset>

        <a-sphere 
            id="moon" 
            segments-height="53"
            segments-width="53" 
            position="0 0 -5" 
            material="src: #groundTexture; normalMap: #normal" 
            radius="2" 
            color="#FFFF" 
            animation="property: rotation; to: 0 360 0; loop: true; dur: 10000 easing: linear">
        </a-sphere>
        
        <a-entity 
            light="type: directional; color: #ff00ff; target: #moon; intensity: 1" 
            position="1 0 1">
        </a-entity>

        <a-entity 
            light="type: directional; color: #ffef; target: #moon; intensity: 1" position="-1 0 1">
        </a-entity>

        <a-entity 
            geometry="primitive:sphere; radius:.15"
            material="color: #fff; shader: flat"
            light="color:#fff; distance: 120">
        </a-entity>

        <a-sky src="#sky"></a-sky>
        
        <a-camera position="0 0 5"></a-camera>
    </a-scene> -->

<!-- Exo 3 -->

<!-- fog="type: linear; color: #01766D; near: 1; far: 5" -->
  <a-scene
    
  >

    <a-asset>

      <!-- Structures -->

      <a-asset-item id="bat1" src="./assets/bati1.glb"></a-asset-item>
      <a-asset-item id="bat2" src="./assets/bati2.glb"></a-asset-item>
      <a-asset-item id="bat3" src="./assets/bati3.glb"></a-asset-item>
      <a-asset-item id="bat4" src="./assets/bati4.glb"></a-asset-item>
      <a-asset-item id="bat5" src="./assets/bati5.glb"></a-asset-item>

      <!-- Objets -->
      <a-asset-item id="cycle" src="./assets/standard_lightcycle__tron_evoluton_battle_grids.glb"></a-asset-item>
      <a-asset-item id="car" src="./assets/light_runner_v1__tron_evolution_battle_grids.glb"></a-asset-item>
      <a-asset-item id="disk" src="./assets/tron_legacy_identity_disc.glb"></a-asset-item>
      <a-asset-item id="chara" src="./assets/tron_character.glb"></a-asset-item>

      <!-- Socle -->
      <a-asset-item id="socle-obj1" src="./assets/socle1.obj"></a-asset-item>
      <a-asset-item id="socle-mtl1" src="./assets/socle1.mtl"></a-asset-item>

      <a-asset-item id="socle-obj2" src="./assets/socle2.obj"></a-asset-item>
      <a-asset-item id="socle-mtl2" src="./assets/socle2.mtl"></a-asset-item>

      <!-- Audio -->
      <audio id="music" src="./assets/Smooth and Cool - Nico Staf.mp3" preload="auto"></audio>
      
    </a-asset>

    <!-- Musique -->

    <a-sound
      src="./assets/Smooth and Cool - Nico Staf.mp3" autoplay="true" loop="true" volume="0.5">
    </a-sound>

    <!-- Lumière -->
    <!-- <a-entity
    color="#00FFD3"
    geometry="primitive: sphere; radius: 0.5" 
    light="type: ambient; color: #00FFD3; intensity: 3"
    position="0 5 0"
  
    >
    </a-entity> -->

    <!-- environnement -->

    <a-entity 
      environment="
      preset: tron;
      groundColor: #000; 
      grid: 1x1;
      dressing: none;
      gridColor: #F3FBFD;
      horizonColor: #055373; 
      skyColor: #040b07; 
      seed: 44;
      skyType: gradient;
      lightPosition: 0 20 0;
      ground: spikes;
      groundYScale: 5;
      groundColor: #000;
      fog: 0.8;
      dressingVariance: 0.5;
      ">
    </a-entity>

    <!-- batiment 1 -->

    <a-entity 
      object-generator="count: 5; width: 100; height: 100; exclusionZone: {x: 0, z: 0, radius: 35};"
      >
    </a-entity>

    <!-- Ligne 1 -->
    <a-box
      position="0 0.02 0"
      width="0.05"
      height="0.05"
      depth="25"
      color="#F3FBFD"
      >
    </a-box>

    <!-- Ligne 2 -->
    <a-box
      position="0 0.02 0"
      rotation="0 -90 0"
      width="0.05"
      height="0.05"
      depth="25"
      color="#F3FBFD"
      >
    </a-box>

   <!-- Sol  -->
    <a-plane
      position="0 0.01 0"
      rotation="-90 0 0"
      width="26"
      height="26"
      color="#000"
      >
    </a-plane>

    <!-- Sol 2  -->
    <a-plane
      position="0 0.02 0"
      rotation="-90 0 0"
      width="25.5"
      height="25.5"
      color="#F3FBFD"
      >
    </a-plane>

    <!-- Sol 3  -->
    <a-plane
      position="0 0.03 0"
      rotation="-90 0 0"
      width="25"
      height="25"
      color="#000"
      >
    </a-plane>

    <a-circle
      position="9 0.04 9"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>
    
    <!-- <a-obj-model src="#socle-obj2" mtl="#socle-mtl2" position="0 0 0" scale="1 1 1"></a-obj-model> -->
     
    <!-- Disque -->

    <a-circle
      position="9 0.04 9"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>

    <a-obj-model src="#socle-obj1" mtl="#socle-mtl1" position="9 -0.1 9"></a-obj-model>

    <a-entity
      gltf-model="#disk"
      position="9 1.5 9"
      scale="0.4 0.4 0.4"
      rotation="35 -120 5"
      animdisk="speed: 20"
      >
    </a-entity>

    <!-- Personnage -->

    <a-circle
      position="-9 0.04 -9"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>
    
    <a-obj-model src="#socle-obj1" mtl="#socle-mtl1" position="-9 -0.1 -9" scale="1 1 1"></a-obj-model>

    <a-entity
      position="-9 1 -9"
      rotation="0 35 0"
      gltf-model="#chara"
      scale="0.004 0.004 0.004"
      anim="speed: 5"
      >
    </a-entity>

    <!-- Moto -->  
     
    <a-circle
      position="9 0.04 -9"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>
    
    <a-obj-model src="#socle-obj1" mtl="#socle-mtl1" position="9 -0.1 -9" scale="1 1 1"></a-obj-model>

    <a-entity
      position="9 0.5 -9"
      rotation="0 -135 0"
      gltf-model="#cycle"
      scale="0.2 0.2 0.2"
      anim="speed: 5"
      >
    </a-entity>

    <!-- Voiture -->

    <a-circle
      position="-9 0.04 9"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>
    
    <a-obj-model src="#socle-obj1" mtl="#socle-mtl1" position="-9 -0.1 9" scale="1 1 1"></a-obj-model>

    <a-entity
      position="-9 1.2 9"
      rotation="0 -145 0"
      scale="10 10 10"
      gltf-model="#car"
      anim="speed: 5"
      >
    </a-entity>

    <!-- Zone d'aparition -->

    <a-circle
      position="0 0.06 0"
      rotation="-90 0 0"
      radius="0.7"
      color="#55E2DB">
    </a-circle>

    <a-circle
      position="0 0.05 0"
      rotation="-90 0 0"
      radius="0.8"
      color="#F3FBFD">
      
    </a-circle>

    <a-circle
      position="0 0.04 0"
      rotation="-90 0 0"
      radius="0.9"
      color="#000">
    </a-circle>


    <!-- Joueur -->
    <a-entity id="player" position="0 1.6 0">
      <!-- camera -->
      <a-entity id="camera" camera wasd-controls look-controls></a-entity>
      <!-- hand controls -->
      <a-entity
        id="left-hand"
        oculus-touch-controls="hand: left"
        blink-controls
      ></a-entity>
      <a-entity
        id="right-hand"
        oculus-touch-controls="hand: right"
        raycaster="objects: .clickable; far: 10; showLine: true"
      ></a-entity>
    </a-entity>

    <!-- Camera new -->
    <!-- <a-entity id="rig">
      <a-entity camera look-controls wasd-controls position="0 1.7 4">
      </a-entity>
    </a-entity> -->

    <!-- Ancienne camera -->
    <!-- <a-camera
      position="0 1.7 4"
    ></a-camera> -->

    <!-- Environnement -->
    <!-- <a-entity environment="preset: forest; dressingAmount: 500"></a-entity> -->

  </a-scene>

  <!-- Script de rotation -->

  <script>
    // New component anim - doit être placé sur un élément de la scène, avec ou sans valeur.
    AFRAME.registerComponent("animdisk", {
      // objet qui définit les propriétés du composant.
      schema: {
        // Propriété speed de type number avec une valeur par défaut de 1.
        speed: { type: "number", default: 1 },
      },
      // Fonction appelée ts les x ms.
      tick: function (time, timeDelta) {
        // Récupère l'attribut rotation de l'élément.
        let rotation = this.el.getAttribute("rotation");
        // Incrémente la valeur y de l'attribut rotation.
        rotation.y += this.data.speed * (timeDelta / 1000);

        rotation.x += this.data.speed * (timeDelta / 1000);

        let position = this.el.getAttribute("position");

        position.y += Math.sin(time / 1000) * 0.001;

        // Met à jour l'attribut rotation de l'élément.
        this.el.setAttribute("rotation", rotation,);
        this.el.setAttribute("position", position);
      },
    });

    AFRAME.registerComponent("anim",{

      schema: {

        speed: { type: "number", default: 1 },

      },

      tick: function(time, timeDelta){

        let rotation = this.el.getAttribute("rotation");

        rotation.y += this.data.speed * (timeDelta / 1000);

        let position = this.el.getAttribute("position");

        this.el.setAttribute("rotation", rotation);

      }

    })

    // Script de placement aléatoire de bat1
    
    AFRAME.registerComponent('object-generator', {
    schema: {
      count: { type: 'int', default: 10 }, // Nombre d'objets
      width: { type: 'number', default: 10 }, // Largeur de la zone
      height: { type: 'number', default: 10 }, // Hauteur de la zone
      exclusionZone: { type: 'vec3', default: { x: 0, z: 0, radius: 5 } }, // Zone d'exclusion
      minDistance: { type: 'number', default: 2 } // Distance minimale entre les objets
    },
    init: function () {
      const data = this.data;
      const positions = [];
      const models = ['#bat1', '#bat2', '#bat3', '#bat4', '#bat5']; // Liste des modèles 3D

      for (let i = 0; i < data.count; i++) {
        let position;
        let isValidPosition = false;
        while (!isValidPosition) {
          position = this.getRandomPosition(data.width, data.height, data.exclusionZone); 
          isValidPosition = this.isValidPosition(position, positions, data.minDistance);
        }
        positions.push(position);

        const entity = document.createElement('a-entity'); // Création de l'entité
        const randomModel = models[Math.floor(Math.random() * models.length)]; // Sélection aléatoire du modèle
        const randomRotation = this.getRandomRotation(); // Génération d'une rotation aléatoire
        entity.setAttribute('position', position); // Position aléatoire
        entity.setAttribute('gltf-model', randomModel); // Utilisation du modèle 3D aléatoire
        entity.setAttribute('rotation', randomRotation); // Rotation aléatoire
        entity.setAttribute('scale', '0.5 0.5 0.5'); 
        this.el.appendChild(entity);
      }
    },
    getRandomPosition: function (width, height, exclusionZone) { // Génère une position aléatoire
      let x, z;
      do {
        x = Math.random() * width - width / 2;
        z = Math.random() * height - height / 2;
      } while (Math.sqrt((x - exclusionZone.x) ** 2 + (z - exclusionZone.z) ** 2) < exclusionZone.radius);
      return { x: x, y: 0.5, z: z };
    },
    getRandomRotation: function () { // Génère une rotation aléatoire
      const yRotation = Math.random() * 360; // Rotation aléatoire autour de l'axe Y
      return { x: 0, y: yRotation, z: 0 };
    },
    isValidPosition: function (position, positions, minDistance) { // Vérifie si la position est valide
      for (let i = 0; i < positions.length; i++) {
        const existingPosition = positions[i];
        const distance = Math.sqrt(
          (position.x - existingPosition.x) ** 2 +
          (position.z - existingPosition.z) ** 2
        );
        if (distance < minDistance) {
          return false;
        }
      }
      return true;
    }
  });

  </script>

  </body>
</html>