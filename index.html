<html>
  <head>
    <title>Setup</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/aframe-blink-controls/dist/aframe-blink-controls.min.js"></script>

  </head>
  <body>
    <!-- exo 1 <a-scene>
      <a-box position="0 0.5 -5" rotation="0 45 0" color="#4CC3D9"></a-box>
      <a-sphere position="0 1.5 -5" radius="0.5" color="#EF2D5E"></a-sphere>
      <a-cylinder position="0 2.5 -5" radius="0.5" rotation="90 0 -30" height="1.5" color="#FFC65D"></a-cylinder>
      <a-plane position="0 0 -4" rotation="-90 0 0" width="4" height="4" color="#7BC8A4"></a-plane>
      <a-sky color="#ECECEC"></a-sky>
      <a-camera position="0 1.5 5"></a-camera>
    </a-scene> -->

    <!-- exo 2 -->

    <!-- <a-scene>
        <a-asset>
            <img id="groundTexture" src="/assets/Moon_texture.jpg" alt="">
            <img id="normal" src="/assets/normal.jpg" alt="">
            <img id="sky" src="assets/sky.jpg" alt="">
        </a-asset>

        <a-sphere 
            id="moon" 
            segments-height="53"
            segments-width="53" 
            position="0 0 -5" 
            material="src: #groundTexture; normalMap: #normal" 
            radius="2" 
            color="#FFFF" 
            animation="property: rotation; to: 0 360 0; loop: true; dur: 10000 easing: linear">
        </a-sphere>
        
        <a-entity 
            light="type: directional; color: #ff00ff; target: #moon; intensity: 1" 
            position="1 0 1">
        </a-entity>

        <a-entity 
            light="type: directional; color: #ffef; target: #moon; intensity: 1" position="-1 0 1">
        </a-entity>

        <a-entity 
            geometry="primitive:sphere; radius:.15"
            material="color: #fff; shader: flat"
            light="color:#fff; distance: 120">
        </a-entity>

        <a-sky src="#sky"></a-sky>
        
        <a-camera position="0 0 5"></a-camera>
    </a-scene> -->

<!-- Exo 3 -->

<!-- fog="type: linear; color: #01766D; near: 1; far: 5" -->
  <a-scene
    
  >

    <a-asset>

      <!-- Structures -->

      <a-asset-item id="bat1" src="./assets/bati1.glb"></a-asset-item>
      <a-asset-item id="bat2" src="./assets/bati2.glb"></a-asset-item>
      <a-asset-item id="bat3" src="./assets/bati3.glb"></a-asset-item>
      <a-asset-item id="bat4" src="./assets/bati4.glb"></a-asset-item>
      <a-asset-item id="bat5" src="./assets/bati5.glb"></a-asset-item>

      <!-- Objets -->
      <a-asset-item id="cycle" src="./assets/standard_lightcycle__tron_evoluton_battle_grids.glb"></a-asset-item>
      <a-asset-item id="cyleorange" src="./assets/moto-orange-test.glb"></a-asset-item>
      <a-asset-item id="car" src="./assets/light_runner_v1__tron_evolution_battle_grids.glb"></a-asset-item>
      <a-asset-item id="disk" src="./assets/tron_legacy_identity_disc.glb"></a-asset-item>
      <a-asset-item id="chara" src="./assets/tron_character.glb"></a-asset-item>
      <a-asset-item id="avion1" src="./assets/one_man_light_jet_tron.glb"></a-asset-item>
      <a-asset-item id="avion2" src="./assets/three_man_light_jet_tron.glb"></a-asset-item>

      <!-- Socle -->
      <a-asset-item id="socle-obj1" src="./assets/socle1.obj"></a-asset-item>
      <a-asset-item id="socle-mtl1" src="./assets/socle1.mtl"></a-asset-item>

      <a-asset-item id="socle-obj2" src="./assets/socle2.obj"></a-asset-item>
      <a-asset-item id="socle-mtl2" src="./assets/socle2.mtl"></a-asset-item>

      <!-- Audio -->
      <audio id="music" src="./assets/Smooth and Cool - Nico Staf.mp3" preload="auto"></audio>
      
    </a-asset>

    <!-- Lumière -->
    <!-- <a-entity
    color="#00FFD3"
    geometry="primitive: sphere; radius: 0.5" 
    light="type: ambient; color: #00FFD3; intensity: 3"
    position="0 5 0"
  
    >
    </a-entity> -->

    <!-- environnement -->

    <a-entity 
      environment="
      preset: tron;
      groundColor: #000; 
      grid: 1x1;
      dressing: none;
      gridColor: #F3FBFD;
      horizonColor: #055373; 
      skyColor: #040b07; 
      stageSize: 200;
      seed: 44;
      skyType: gradient;
      lightPosition: 0 20 0;
      ground: spikes;
      groundYScale: 5;
      groundColor: #000;
      fog: 0.8;
      dressingVariance: 0.5;
      "
      sound="src: #music; autoplay: true; loop: true; volume: 0.5"
      >
    </a-entity>

    <!-- Bat1 -->

    <a-entity
      gltf-model="#bat1"
      position="50 -0.5 -50"
      scale="0.4 0.4 0.4"
      >
    </a-entity>

    <a-entity
      gltf-model="#bat1"
      position="20 -0.5 -60"
      scale="0.4 0.4 0.4"
      >
    </a-entity>

    <a-entity
      gltf-model="#bat1"
      position="50 -0.5 -80"
      scale="0.4 0.4 0.4"
      >
    </a-entity>

    <!-- Bat2 -->
    
    <a-entity
      gltf-model="#bat2"
      position="-50 -0.5 50"
      scale="0.4 0.4 0.4"
      >
    </a-entity>

    <!-- Bat3 -->
    <a-entity
      gltf-model="#bat3"
      position="50 -0.5 50"
      rotation="0 90 0"
      scale="0.4 0.4 0.4"
      >
    </a-entity>

    <!-- Bat4 -->
    <a-entity
      gltf-model="#bat4"
      position="-50 -0.5 -50"
      scale="0.4 0.4 0.4"
      >
    </a-entity>

    <!-- Bat5 -->
    <a-entity
      gltf-model="#bat5"
      position="35 -0.5 35"
      scale="0.4 0.4 0.4"
      >
    </a-entity>
      
    <a-entity
      gltf-model="#bat5"
      position="65 -0.5 35"
      scale="0.4 0.4 0.4"
      >
    </a-entity>

    <!-- Avion 1 -->
    <a-entity
        gltf-model="#avion1"
        position="50 0 35"
        scale="0.01 0.01 0.01"
        flying="speed: 0.5"
      >
    </a-entity>

    <!-- Avion 2 -->
    <a-entity
        data-cible="cible1"
        class="clickable"
        gltf-model="#avion1"
        position="50 2 35"
        scale="0.01 0.01 0.01"
        rotation="0 45 0"
        interactable
      >
    </a-entity>

    <!-- Avion 3 -->

    <a-entity
        gltf-model="#avion2"
        position="0 30 0"
        scale="0.01 0.01 0.01"
        flyingtwo="speed: 0.5"
      >
    </a-entity>

    <!-- Avion 4 -->

    <a-entity
        gltf-model="#avion2"
        position="0 32 0"
        scale="0.01 0.01 0.01"
        rotation="0 45 0"
        flyingthree="speed: 1"
      >
    </a-entity>

    <!--Anim text -->

    <a-entity
        id="introText"
        text="value: Explorez et cherchez les 4 objets de l'univers de TRON. Cliquez sur les éléments avec le curseur pour faire apparaitre les sphères d'énergies.; color: #F3FBFD; width: 6"
        position="0 2 -5"
        opacity-fade="duration: 5000"
      ></a-entity>

    <!-- Ligne 1 -->
    <a-box
      position="0 0.02 0"
      width="0.05"
      height="0.05"
      depth="25"
      color="#F3FBFD"
      >
    </a-box>

    <!-- Ligne 2 -->
    <a-box
      position="0 0.02 0"
      rotation="0 -90 0"
      width="0.05"
      height="0.05"
      depth="25"
      color="#F3FBFD"
      >
    </a-box>

   <!-- Sol  -->
    <a-plane
      position="0 0.01 0"
      rotation="-90 0 0"
      width="26"
      height="26"
      color="#000"
      >
    </a-plane>

    <!-- Sol 2  -->
    <a-plane
      position="0 0.02 0"
      rotation="-90 0 0"
      width="25.5"
      height="25.5"
      color="#F3FBFD"
      >
    </a-plane>

    <!-- Sol 3  -->
    <a-plane
      position="0 0.03 0"
      rotation="-90 0 0"
      width="25"
      height="25"
      color="#000"
      >
    </a-plane>

    <!-- Porte 1 -->
    <a-entity
      gltf-model="#bat3"
      position="0 -0.5 -13"
      rotation="0 90 0"
      scale="0.2 0.2 0.2"
      >
    </a-entity>
    
    <!-- Porte 2 -->
    <a-entity
      gltf-model="#bat3"
      position="0 -0.5 13"
      rotation="0 -90 0"
      scale="0.2 0.2 0.2"
      >
    </a-entity>

    <!-- Porte 3 -->
    <a-entity
      gltf-model="#bat3"
      position="12.5 -0.5 0"
      rotation="0 180 0"
      scale="0.2 0.2 0.2"
      >
    </a-entity>

    <!-- Porte 4 -->
    <a-entity
      gltf-model="#bat3"
      position="-12.5 -0.5 0"
      rotation="0 0 0"
      scale="0.2 0.2 0.2"
      >
    </a-entity>

    <!-- Mur 1 -->

    <a-box
      position="8 0.5 -12"
      width="10"
      height="10"
      depth="0.2"
      color="#55E2DB"
      
      >
    </a-box>

    <a-box
      position="8 0.5 -12"
      width="10"
      height="8"
      depth="0.6"
      color="#000"
      >
    </a-box>

    <!-- Mur 2 -->

    <a-box
      position="8 0.5 12"
      width="10"
      height="10"
      depth="0.2"
      color="#55E2DB"
      
      >
    </a-box>

    <a-box
      position="8 0.5 12"
      width="10"
      height="8"
      depth="0.6"
      color="#000"
      >
    </a-box>

    <!-- Mur 3 -->

    <a-box
      position="12 0.5 8"
      width="0.2"
      height="10"
      depth="10"
      color="#55E2DB"
      
      >
    </a-box>

    <a-box
      position="12 0.5 8"
      width="0.6"
      height="8"
      depth="10"
      color="#000"
      >
    </a-box>

    <!-- Mur 4 -->

    <a-box
      position="-12 0.5 8"
      width="0.2"
      height="10"
      depth="10"
      color="#55E2DB"
      >
    </a-box>

    <a-box
      position="-12 0.5 8"
      width="0.6"
      height="8"
      depth="10"
      color="#000"
      >
    </a-box>
    
    <!-- Mur 5 -->

    <a-box
      position="-8 0.5 12"
      width="0.2"
      height="10"
      depth="10"
      rotation="0 90 0"
      color="#55E2DB"
      >
    </a-box>

    <a-box
      position="-8 0.5 12"
      width="0.6"
      height="8"
      depth="10"
      rotation="0 90 0"
      color="#000"
      >
    </a-box>

    <!-- Mur 6 -->

    <a-box
      position="-8 0.5 -12"
      width="0.2"
      height="10"
      depth="10"
      rotation="0 90 0"
      color="#55E2DB"
      >
    </a-box>

    <a-box
      position="-8 0.5 -12"
      width="0.6"
      height="8"
      depth="10"
      rotation="0 90 0"
      color="#000"
      >
    </a-box>

    <!-- Mur 7 -->

    <a-box
      position="12 0.5 -8"
      width="0.2"
      height="10"
      depth="10"
      rotation="0 180 0"
      color="#55E2DB"
      >
    </a-box>

    <a-box
      position="12 0.5 -8"
      width="0.6"
      height="8"
      depth="10"
      rotation="0 180 0"
      color="#000"
      >
    </a-box>

    <!-- Mur 8 -->

    <a-box
      position="-12 0.5 -8"
      width="0.2"
      height="10"
      depth="10"
      rotation="0 180 0"
      color="#55E2DB"
      >
    </a-box>

    <a-box
      position="-12 0.5 -8"
      width="0.6"
      height="8"
      depth="10"
      rotation="0 180 0"
      color="#000"
      >
    </a-box>

    <!-- Tour 1 -->

    <a-box
      position="12 0.5 12"
      width="3.5"
      height="11"
      depth="3.5"
      color="#55E2DB"
      light="type: ambient; color: #55E2DB"
      >
    </a-box>

    <a-box
      position="12 0.5 12"
      width="3.8"
      height="8"
      depth="3.8"
      color="#000"
      >
    </a-box>

    <a-sphere
      data-cible="cible1"
      visible="false"
      position="12 8 12"
      radius="1"
      color="#ff7f00"
      >
    </a-sphere>

    <!-- Tour 2 -->
     
    <a-box
      position="-12 0.5 12"
      width="3.5"
      height="11"
      depth="3.5"
      color="#55E2DB"
      light="type: ambient; color: #55E2DB"
      >
    </a-box>

    <a-box
      position="-12 0.5 12"
      width="3.8"
      height="8"
      depth="3.8"
      color="#000"
      >
    </a-box>

    <a-sphere
      position="-12 8 12"
      radius="1"
      color="#55E2DB"
      >
    </a-sphere>

    <!-- Tour 3 -->

    <a-box
      position="12 0.5 -12"
      width="3.5"
      height="11"
      depth="3.5"
      color="#55E2DB"
      light="type: ambient; color: #55E2DB"
      >
    </a-box>

    <a-box
      position="12 0.5 -12"
      width="3.8"
      height="8"
      depth="3.8"
      color="#000"
      >
    </a-box>

    <a-sphere
      position="12 8 -12"
      radius="1"
      color="#55E2DB"
      >
    </a-sphere>

    <!-- Tour 4 -->

    <a-box
      position="-12 0.5 -12"
      width="3.5"
      height="11"
      depth="3.5"
      color="#55E2DB"
      light="type: ambient; color: #55E2DB"
      >
    </a-box>

    <a-box
      position="-12 0.5 -12"
      width="3.8"
      height="8"
      depth="3.8"
      color="#000"
      >
    </a-box>

    <a-sphere
      position="-12 8 -12"
      radius="1"
      color="#55E2DB"
      >
    </a-sphere>

    <!-- <a-obj-model src="#socle-obj2" mtl="#socle-mtl2" position="0 0 0" scale="1 1 1"></a-obj-model> -->
     
    <!-- Disque -->

    <a-circle
      position="8 0.04 8"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>

    <a-obj-model src="#socle-obj1" mtl="#socle-mtl1" position="8 -0.1 8"></a-obj-model>

    <a-entity
      gltf-model="#disk"
      position="8 1.5 8"
      scale="0.4 0.4 0.4"
      rotation="35 -120 5"
      animdisk="speed: 20"
      >
    </a-entity>

    <!-- Personnage -->

    <a-circle
      position="-8 0.04 -8"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>
    
    <a-obj-model src="#socle-obj1" mtl="#socle-mtl1" position="-8 -0.1 -8" scale="1 1 1"></a-obj-model>

    <a-entity
      position="-8 1 -8"
      rotation="0 35 0"
      gltf-model="#chara"
      scale="0.004 0.004 0.004"
      anim="speed: 5"
      >
    </a-entity>

    <!-- Moto -->  
     
    <a-circle
      position="8 0.04 -8"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>
    
    <a-obj-model src="#socle-obj1" mtl="#socle-mtl1" position="8 -0.1 -8" scale="1 1 1"></a-obj-model>

    <a-entity
      position="8 0.5 -8"
      rotation="0 -135 0"
      gltf-model="#cycle"
      scale="0.2 0.2 0.2"
      anim="speed: 5"
      >
    </a-entity>

    <!-- Voiture -->

    <a-circle
      position="-8 0.04 8"
      rotation="-90 0 0"
      radius="1"
      color="#F3FBFD">
    </a-circle>
    
    <a-obj-model src="#socle-obj1" mtl="#socle-mtl1" position="-8 -0.1 8" scale="1 1 1"></a-obj-model>

    <a-entity
      position="-8 1.2 8"
      rotation="0 -145 0"
      scale="10 10 10"
      gltf-model="#car"
      anim="speed: 5"
      >
    </a-entity>

    <!-- Zone d'aparition -->

    <a-circle
      position="0 0.06 0"
      rotation="-90 0 0"
      radius="0.7"
      color="#55E2DB">
    </a-circle>

    <a-circle
      position="0 0.05 0"
      rotation="-90 0 0"
      radius="0.8"
      color="#F3FBFD">
      
    </a-circle>

    <a-circle
      position="0 0.04 0"
      rotation="-90 0 0"
      radius="0.9"
      color="#000">
    </a-circle>


    <!-- Joueur -->
    <a-entity id="player" position="0 1.6 0">
      <!-- camera -->
      <a-entity id="camera" camera wasd-controls look-controls></a-entity>
      <!-- hand controls -->
      <a-entity
        id="left-hand"
        oculus-touch-controls="hand: left"
        blink-controls
      ></a-entity>
      <a-entity
        id="right-hand"
        oculus-touch-controls="hand: right"
        raycaster="objects: .clickable; far: 15; showLine: true"
      ></a-entity>
    </a-entity>

  </a-scene>

  <!-- Script de rotation -->

  <script>
    
    // Script de rotation du disque
    AFRAME.registerComponent("animdisk", {
      // objet qui définit les propriétés du composant.
      schema: {
        // Propriété speed de type number avec une valeur par défaut de 1.
        speed: { type: "number", default: 1 },
      },
      // Fonction appelée ts les x ms.
      tick: function (time, timeDelta) {
        // Récupère l'attribut rotation de l'élément.
        let rotation = this.el.getAttribute("rotation");
        // Incrémente la valeur y de l'attribut rotation.
        rotation.y += this.data.speed * (timeDelta / 1000);

        rotation.x += this.data.speed * (timeDelta / 1000);

        let position = this.el.getAttribute("position");

        position.y += Math.sin(time / 1000) * 0.001;

        // Met à jour l'attribut rotation de l'élément.
        this.el.setAttribute("rotation", rotation,);
        this.el.setAttribute("position", position);
      },
    });

    // Script de rotation des objets
    AFRAME.registerComponent("anim",{

      schema: {

        speed: { type: "number", default: 1 },

      },

      tick: function(time, timeDelta){

        let rotation = this.el.getAttribute("rotation");

        rotation.y += this.data.speed * (timeDelta / 1000);

        let position = this.el.getAttribute("position");

        this.el.setAttribute("rotation", rotation);

      }

    })

    AFRAME.registerComponent("flying", {
  schema: {
    speed: { type: "number", default: 1 },
  },
  tick: function (time, timeDelta) {
    let position = this.el.getAttribute("position");
    let rotation = this.el.getAttribute("rotation");

    // Mouvement de vol en cercle autour de la position initiale
    const initialX = 50;
    const initialZ = 35;
    position.x = initialX + Math.sin(time / 1000 * this.data.speed) * 10;
    position.z = initialZ + Math.cos(time / 1000 * this.data.speed) * 10;

    // Mouvement de haut en bas
    position.y = 40 + Math.sin(time / 1000 * this.data.speed) * 10;

    // Rotation pour simuler le vol
    rotation.y = (time / 1000 * this.data.speed * 180 / Math.PI) % 360;

    this.el.setAttribute("position", position);
    this.el.setAttribute("rotation", rotation);
  },
});

AFRAME.registerComponent("flyingtwo", {
  schema: {
    speed: { type: "number", default: 1 },
  },
  tick: function (time, timeDelta) {
    let position = this.el.getAttribute("position");
    let rotation = this.el.getAttribute("rotation");

    // Mouvement de vol en cercle autour de la position initiale
    const initialX = 0;
    const initialZ = 0;
    position.x = initialX + Math.sin(time / 1000 * this.data.speed) * 50;
    position.z = initialZ + Math.cos(time / 1000 * this.data.speed) * 50;

    // Mouvement de haut en bas
    position.y = 20 + Math.sin(time / 1000 * this.data.speed) * 10;

    // Rotation pour simuler le vol
    rotation.y = (time / 1000 * this.data.speed * 180 / Math.PI) % 360;

    this.el.setAttribute("position", position);
    this.el.setAttribute("rotation", rotation);
  },
});

AFRAME.registerComponent("flyingthree", {
  schema: {
    speed: { type: "number", default: 1 },
  },
  tick: function (time, timeDelta) {
    let position = this.el.getAttribute("position");
    let rotation = this.el.getAttribute("rotation");

    // Mouvement de vol en cercle autour de la position initiale
    const initialX = 0;
    const initialZ = 0;
    position.x = initialX + Math.sin(time / 1000 * this.data.speed) * 50;
    position.z = initialZ + Math.cos(time / 1000 * this.data.speed) * 50;

    // Mouvement de haut en bas
    position.y = 18 + Math.sin(time / 1000 * this.data.speed) * 10;

    // Rotation pour simuler le vol
    rotation.y = (time / 1000 * this.data.speed * 180 / Math.PI) % 360;

    this.el.setAttribute("position", position);
    this.el.setAttribute("rotation", rotation);
  },
});

// interaction avec les objets
AFRAME.registerComponent("interactable", {
        init: function () {
          // Add event listener for the laser interaction
          // Change the color of the box on hover
          this.el.addEventListener("mouseenter", () => {
            this.el.setAttribute("scale", "0.03 0.03 0.03"); // Visual feedback
          });
          // Reset the color on mouse leave
          this.el.addEventListener("mouseleave", () => {
            this.el.setAttribute("scale", "0.01 0.01 0.01"); // Reset color
          });

          // Add event listener for the click interaction
          this.el.addEventListener("click", () => {
            // Get the target entity
            const target = document.querySelector(
              `#${this.el.getAttribute("data-cible")}`
            );
            // la cible devient visibility
            target.setAttribute("visible", "true");

            console.log(target);
          });
        },
      });

      // Opacité du texte
      AFRAME.registerComponent("opacity-fade", {
        schema: {
          duration: { type: "number", default: 10000 }
        },
        init: function () {
          this.startTime = null;
        },
        tick: function (time, timeDelta) {
          if (!this.startTime) {
            this.startTime = time;
          }

          const elapsed = time - this.startTime;
          const opacity = 1 - elapsed / this.data.duration;

          if (opacity <= 0) {
            this.el.setAttribute("visible", "false");
            this.el.removeAttribute("opacity-fade");
          } else {
            this.el.setAttribute("text", "opacity", opacity);
          }
        }
      });


  </script>

  </body>
</html>